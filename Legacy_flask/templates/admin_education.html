{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width:980px;">
  <h1 class="mt-3">Admin — Education</h1>
  <p class="text-muted">Upload/manage education videos shown on the public <a href="{{ url_for('page_education') }}">Education</a> page.</p>

  <hr>

  <!-- Upload -->
  <h3>Upload Video</h3>
  <form id="edu-upload-form" class="mb-4">
    <div class="row g-2">
      <div class="col-md-6">
        <label class="form-label">Title</label>
        <input class="form-control" name="title" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Category</label>
        <select class="form-select" name="category">
          <option value="basics">basics</option>
          <option value="strategies">strategies</option>
          <option value="risk">risk</option>
          <option value="platform">platform</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Duration (mm:ss)</label>
        <input class="form-control" name="duration" placeholder="09:48">
      </div>
    </div>
    <div class="mt-2">
      <label class="form-label">File</label>
      <input class="form-control" type="file" name="file" accept="video/*" required>
    </div>
    <button class="btn btn-primary mt-3" type="submit">Upload</button>
    <span id="edu-upload-status" class="ms-2 text-muted"></span>
  </form>

  <!-- List -->
  <h3>Library</h3>
  <div class="d-flex mb-2">
    <button class="btn btn-secondary btn-sm" id="edu-refresh">Refresh</button>
  </div>
  <div id="edu-table">Loading…</div>
</div>

<script>
const ADMIN_TOKEN = "{{ admin_token or '' }}";
async function eduList(){
  const r = await fetch('/api/admin/education/list', { headers: {'Authorization':'Bearer '+ADMIN_TOKEN}});
  const data = await r.json().catch(_=>({items:[]}));
  const items = data.items||[];
  if(!items.length){ document.getElementById('edu-table').innerHTML = '<p class="text-muted">No videos.</p>'; return; }
  let html = `<table class="table table-striped"><thead><tr>
    <th>Title</th><th>Category</th><th>Duration</th><th>URL</th><th></th></tr></thead><tbody>`;
  for(const v of items){
    html += `<tr>
      <td>${v.title||''}</td>
      <td>${v.category||''}</td>
      <td>${v.duration||''}</td>
      <td><code>${v.url||''}</code></td>
      <td class="text-nowrap">
        <button class="btn btn-sm btn-outline-danger" onclick="eduDelete('${v.id}')">Delete</button>
      </td>
    </tr>`;
  }
  html += `</tbody></table>`;
  document.getElementById('edu-table').innerHTML = html;
}
async function eduDelete(id){
  if(!confirm('Delete this video?')) return;
  await fetch('/api/admin/education/delete', {
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+ADMIN_TOKEN},
    body: JSON.stringify({id})
  });
  eduList();
}
document.getElementById('edu-refresh').onclick = eduList;
document.getElementById('edu-upload-form').onsubmit = async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const el = document.getElementById('edu-upload-status');
  el.textContent = 'Uploading…';
  const r = await fetch('/api/admin/education/upload', {
    method:'POST', headers:{'Authorization':'Bearer '+ADMIN_TOKEN}, body: fd
  });
  el.textContent = (r.ok?'Uploaded ✅':'Upload failed ❌');
  eduList();
  e.target.reset();
};
document.addEventListener('DOMContentLoaded', eduList);
</script>
{% endblock %}
